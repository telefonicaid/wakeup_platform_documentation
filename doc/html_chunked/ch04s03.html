<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>SSL Terminator</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="WakeUp platform"><link rel="up" href="ch04.html" title="Chapter 4. Installation and Configuration"><link rel="prev" href="ch04s02.html" title="Global node"><link rel="next" href="ch04s04.html" title="Create your own Certification Authority"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">SSL Terminator</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04s02.html">Prev</a> </td><th width="60%" align="center">Chapter 4. Installation and Configuration</th><td width="20%" align="right"> <a accesskey="n" href="ch04s04.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp49810288"></a>SSL Terminator</h2></div></div></div><p>
      The service is designed to work with a SSL Terminator / SSL Offloader
      as a frontend, in other words, all connections SHALL be verified with a
      HTTP SSL Server (Hardware terminators, Apache, NGINX, ...)
    </p><p>
      These servers will verify client and pass the SSL verification result to
      the Wakeup servers with these HTTP extended HEADERS:
    </p><p>
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
          X-Real-IP:
          <p>
            This header will contain the IP address of the client.
          </p></li><li class="listitem">
          X-Forwarded-For:
          <p>
            This headers contains the different proxies IP addresses used
            between the client and the server.
          </p></li><li class="listitem">
          X-Client-Cert-DN:
          <p>
            This will contain the client certificate DN string used to
            identify the client in all log traces.
          </p></li><li class="listitem">
          X-Client-Cert-Verified:
          <p>
            If SSL client verification is valid and SSL terminator rely on
            this. To consider a succesful check this header SHALL be 'SUCCESS'.
          </p><p>
            Any other value will be cosidered an invalid certificate and
            the connection will be rejected.
          </p></li></ul></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="idp49847120"></a>NGINX example setup</h3></div></div></div><p>
        If you decide to use NGINX as a
        <a class="link" href="http://wiki.nginx.org/SSL-Offloader" target="_top">
          software terminator
        </a>
        , you can use this configuration file as a template.
      </p><p>
        Into the utils/test_ca folder of main wakeup_platform project
        (<a class="xref" href="ch06.html" title="Chapter 6. Source Code">wakeup_platform</a>)
        you will locate this sample configuration that can be used as a
        simple reference:
      </p><p>
        </p><pre class="programlisting">
# See http://wiki.nginx.org/HttpSslModule
# and http://wiki.nginx.org/HttpProxyModule

server {
    listen        443;
    ssl on;
    server_name example.com;

    ssl_certificate /TEST_CERTIFICATES/server.crt;
    ssl_certificate_key /TEST_CERTIFICATES/server.key;
    ssl_client_certificate /TEST_CERTIFICATES/ca.crt;
    ssl_verify_client on;

    location /global/ {
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $http_host;
      proxy_set_header X-NginX-Proxy true;

      proxy_set_header X-Client-Cert-DN $ssl_client_s_dn;
      proxy_set_header X-Client-Cert-Verified $ssl_client_verify;

      proxy_pass http://localhost:8000/;
      proxy_redirect off;
    }

    location /local/ {
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $http_host;
      proxy_set_header X-NginX-Proxy true;

      proxy_set_header X-Client-Cert-DN $ssl_client_s_dn;
      proxy_set_header X-Client-Cert-Verified $ssl_client_verify;

      proxy_pass http://localhost:9000/;
      proxy_redirect off;
    }

}

        </pre><p>
      </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04s02.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch04.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch04s04.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Global node </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Create your own Certification Authority</td></tr></table></div></body></html>
